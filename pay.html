<!DOCTYPE html>
<html lang="ko">
<head>
    <script>
    // ì—ëŸ¬ê°€ ë‚˜ë©´ í™”ë©´ì— ê²½ê³ ì°½ìœ¼ë¡œ ë„ì›Œë¼!
    window.onerror = function(msg, url, lineNo, columnNo, error) {
        alert("ğŸš¨ ì—ëŸ¬ ë°œìƒ!\n" + msg + "\nì¤„ ë²ˆí˜¸: " + lineNo);
        return false;
    };
</script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Split ì •ì‚°</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; background-color: #f2f4f6; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .receipt { background: white; width: 100%; max-width: 400px; padding: 30px 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); text-align: center; }
        h2 { margin: 0 0 5px 0; color: #333; font-size: 18px; }
        .total-price { font-size: 32px; font-weight: bold; color: #3182f6; margin-bottom: 30px; }
        .list-container { text-align: left; border-top: 1px solid #eee; padding-top: 20px; }
        .member-btn { display: flex; justify-content: space-between; align-items: center; padding: 15px 10px; border-bottom: 1px solid #f5f5f5; cursor: pointer; transition: background 0.2s; border-radius: 12px; }
        .member-btn:active { background-color: #f0f0f0; }
        .member-name { font-size: 16px; font-weight: 500; color: #333; }
        .member-amt { font-size: 16px; font-weight: bold; color: #3182f6; }
        .footer { margin-top: 30px; font-size: 12px; color: #888; }
        .loading { color: #888; font-size: 14px; margin-top: 50px; }
    </style>
</head>
<body>

<div class="receipt">
    <h2 id="receipt-title">ì˜ìˆ˜ì¦ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h2>
    <div class="total-price" id="receipt-total"></div>
    <div id="list-container" class="list-container">
        <div class="loading">ë°ì´í„°ë¥¼ ì•ˆì „í•˜ê²Œ ê°€ì ¸ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...<br>(ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”)</div>
    </div>
    <div class="footer">ğŸ“¢ Smart Split ì•± ë‹¤ìš´ë¡œë“œ (ê´‘ê³ )</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script src="./js/firebase-config.js"></script>

<script>
    // 3. ì„¤ì • íŒŒì¼(firebase-config.js)ì— ìˆëŠ” í•¨ìˆ˜ë¡œ DB ì‹œì‘!
    const db = initFirebase(); 

    // 4. URLì—ì„œ 'ì—´ì‡ (ID)' êº¼ë‚´ê¸°
    const params = new URLSearchParams(window.location.search);
    const docId = params.get('id');

    if (docId) {
        // 5. ì°½ê³ ì—ì„œ ë°ì´í„° êº¼ë‚´ì˜¤ê¸°
        db.collection("receipts").doc(docId).get().then((doc) => {
            if (doc.exists) {
                const data = doc.data();
                renderReceipt(data);
            } else {
                showError("ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì‚­ì œëœ ì˜ìˆ˜ì¦ì…ë‹ˆë‹¤.");
            }
        }).catch((error) => {
            console.error("Error:", error);
            showError("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
        });
    } else {
        showError("ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤. (ID ì—†ìŒ)");
    }

    // 6. í™”ë©´ì— ê·¸ë¦¬ê¸° í•¨ìˆ˜
    function renderReceipt(data) {
        document.getElementById('receipt-title').innerText = data.title;
        document.getElementById('receipt-total').innerText = Number(data.total).toLocaleString() + "ì›";

        const container = document.getElementById('list-container');
        container.innerHTML = ""; // ë¡œë”© ë¬¸êµ¬ ì‚­ì œ

        // íŒíŠ¸ ë©”ì‹œì§€
        const hint = document.createElement('div');
        hint.style.cssText = "font-size:13px; color:#666; margin-bottom:10px; text-align:center;";
        hint.innerText = "ğŸ‘‡ ë‚´ ì´ë¦„ì„ ëˆ„ë¥´ë©´ í† ìŠ¤ë¡œ ì—°ê²°ë©ë‹ˆë‹¤";
        container.appendChild(hint);

        // ë©¤ë²„ ë¦¬ìŠ¤íŠ¸ ìƒì„±
        data.members.forEach(member => {
            const btn = document.createElement('div');
            btn.className = 'member-btn';
            btn.innerHTML = `
                <span class="member-name">${member.name}</span>
                <span class="member-amt">${Number(member.amount).toLocaleString()}ì› ></span>
            `;
            
            // í´ë¦­ ì‹œ í† ìŠ¤ ì†¡ê¸ˆ ì‹¤í–‰
            btn.onclick = function() {
                const tossUrl = `supertoss://send?amount=${member.amount}&msg=${data.title}`;
                location.href = tossUrl;
            };
            container.appendChild(btn);
        });
    }

    // ì—ëŸ¬ í‘œì‹œ í•¨ìˆ˜
    function showError(msg) {
        document.getElementById('receipt-title').innerText = "ì˜¤ë¥˜";
        document.getElementById('list-container').innerHTML = `<div class="loading" style="color:red;">${msg}</div>`;
    }
</script>

</body>
</html>
